#include "linear_to_mel_weight_list.h"
#include <math.h>


void calc_log_mel_spectrogram(float32_t* magnitude, float32_t* log_mel_spectrogram) {

	// Linear to mel weight matrix condensed as list
	int16_t listsize = 1968;
	float32_t list[] = {
	  3, 6, 0.606486, 7, 0.724642, 8, 0.068580,
	  3, 7, 0.275358, 8, 0.931420, 9, 0.424850,
	  3, 9, 0.575150, 10, 0.792993, 11, 0.172578,
	  3, 10, 0.207007, 11, 0.827422, 12, 0.563203,
	  3, 12, 0.436797, 13, 0.964482, 14, 0.376044,
	  4, 13, 0.035518, 14, 0.623956, 15, 0.797545, 16, 0.228654,
	  4, 15, 0.202455, 16, 0.771346, 17, 0.669058, 18, 0.118456,
	  4, 17, 0.330942, 18, 0.881544, 19, 0.576562, 20, 0.043111,
	  4, 19, 0.423438, 20, 0.956889, 21, 0.517840, 22, 0.000504,
	  3, 21, 0.482160, 22, 0.999496, 23, 0.490860,
	  4, 23, 0.509140, 24, 0.988692, 25, 0.493780, 26, 0.005918,
	  5, 24, 0.011308, 25, 0.506220, 26, 0.994082, 27, 0.524905, 28, 0.050555,
	  4, 27, 0.475095, 28, 0.949445, 29, 0.582680, 30, 0.121112,
	  4, 29, 0.417320, 30, 0.878888, 31, 0.665683, 32, 0.216226,
	  4, 31, 0.334317, 32, 0.783774, 33, 0.772595, 34, 0.334636,
	  5, 33, 0.227405, 34, 0.665364, 35, 0.902202, 36, 0.475160, 37, 0.053378,
	  5, 35, 0.097798, 36, 0.524840, 37, 0.946622, 38, 0.636724, 39, 0.225080,
	  5, 38, 0.363276, 39, 0.774920, 40, 0.818323, 41, 0.416341, 42, 0.019020,
	  5, 40, 0.181677, 41, 0.583659, 42, 0.980980, 43, 0.626256, 44, 0.237945,
	  5, 43, 0.373744, 44, 0.762055, 45, 0.853987, 46, 0.474280, 47, 0.098740,
	  5, 45, 0.146013, 46, 0.525720, 47, 0.901260, 48, 0.727274, 49, 0.359792,
	  5, 48, 0.272726, 49, 0.640208, 50, 0.996210, 51, 0.636449, 52, 0.280427,
	  6, 50, 0.003790, 51, 0.363551, 52, 0.719573, 53, 0.928066, 54, 0.579293, 55, 0.234036,
	  6, 53, 0.071934, 54, 0.420707, 55, 0.765964, 56, 0.892224, 57, 0.553791, 58, 0.218667,
	  6, 56, 0.107776, 57, 0.446209, 58, 0.781333, 59, 0.886790, 60, 0.558098, 61, 0.232530,
	  6, 59, 0.113210, 60, 0.441902, 61, 0.767470, 62, 0.910029, 63, 0.590532, 64, 0.273988,
	  7, 62, 0.089971, 63, 0.409468, 64, 0.726012, 65, 0.960344, 66, 0.649549, 67, 0.341543, 68, 0.036289,
	  7, 65, 0.039656, 66, 0.350451, 67, 0.658457, 68, 0.963711, 69, 0.733723, 70, 0.433813, 71, 0.136500,
	  6, 69, 0.266277, 70, 0.566187, 71, 0.863500, 72, 0.841750, 73, 0.549508, 74, 0.259748,
	  7, 72, 0.158250, 73, 0.450492, 74, 0.740252, 75, 0.972411, 76, 0.687468, 77, 0.404877, 78, 0.124598,
	  8, 75, 0.027589, 76, 0.312532, 77, 0.595123, 78, 0.875402, 79, 0.846592, 80, 0.570823, 81, 0.297258, 82, 0.025860,
	  7, 79, 0.153408, 80, 0.429177, 81, 0.702742, 82, 0.974140, 83, 0.756596, 84, 0.489435, 85, 0.224342,
	  7, 83, 0.243404, 84, 0.510565, 85, 0.775658, 86, 0.961281, 87, 0.700223, 88, 0.441142, 89, 0.184002,
	  8, 86, 0.038719, 87, 0.299777, 88, 0.558858, 89, 0.815998, 90, 0.928784, 91, 0.675455, 92, 0.423977, 93, 0.174340,
	  8, 90, 0.071216, 91, 0.324545, 92, 0.576023, 93, 0.825660, 94, 0.926505, 95, 0.680455, 96, 0.436156, 97, 0.193581,
	  9, 94, 0.073495, 95, 0.319545, 96, 0.563844, 97, 0.806419, 98, 0.952722, 99, 0.713536, 100, 0.476019, 101, 0.240132, 102, 0.005862,
	  9, 98, 0.047278, 99, 0.286464, 100, 0.523981, 101, 0.759868, 102, 0.994138, 103, 0.773176, 104, 0.542062, 105, 0.312500, 106, 0.084462,
	  8, 103, 0.226824, 104, 0.457938, 105, 0.687500, 106, 0.915538, 107, 0.857938, 108, 0.632899, 109, 0.409330, 110, 0.187210,
	  9, 107, 0.142062, 108, 0.367101, 109, 0.590670, 110, 0.812790, 111, 0.966523, 112, 0.747245, 113, 0.529362, 114, 0.312859, 115, 0.097711,
	  10, 111, 0.033477, 112, 0.252755, 113, 0.470638, 114, 0.687141, 115, 0.902289, 116, 0.883909, 117, 0.671433, 118, 0.460274, 119, 0.250402, 120, 0.041810,
	  10, 116, 0.116091, 117, 0.328567, 118, 0.539726, 119, 0.749598, 120, 0.958190, 121, 0.834475, 122, 0.628394, 123, 0.423541, 124, 0.219909, 125, 0.017475,
	  10, 121, 0.165525, 122, 0.371606, 123, 0.576459, 124, 0.780091, 125, 0.982525, 126, 0.816236, 127, 0.616170, 128, 0.417266, 129, 0.219515, 130, 0.022892,
	  10, 126, 0.183764, 127, 0.383830, 128, 0.582734, 129, 0.780485, 130, 0.977108, 131, 0.827400, 132, 0.633006, 133, 0.439714, 134, 0.247509, 135, 0.056372,
	  10, 131, 0.172600, 132, 0.366994, 133, 0.560286, 134, 0.752491, 135, 0.943628, 136, 0.866305, 137, 0.677273, 138, 0.489291, 139, 0.302325, 140, 0.116384,
	  11, 136, 0.133695, 137, 0.322727, 138, 0.510709, 139, 0.697675, 140, 0.883616, 141, 0.931440, 142, 0.747486, 143, 0.564523, 144, 0.382529, 145, 0.201495, 146, 0.021408,
	  11, 141, 0.068560, 142, 0.252514, 143, 0.435477, 144, 0.617471, 145, 0.798505, 146, 0.978592, 147, 0.842274, 148, 0.664068, 149, 0.486779, 150, 0.310410, 151, 0.134946,
	  11, 147, 0.157726, 148, 0.335932, 149, 0.513221, 150, 0.689590, 151, 0.865054, 152, 0.960364, 153, 0.786678, 154, 0.613866, 155, 0.441923, 156, 0.270833, 157, 0.100597,
	  12, 152, 0.039636, 153, 0.213322, 154, 0.386134, 155, 0.558077, 156, 0.729167, 157, 0.899403, 158, 0.931202, 159, 0.762642, 160, 0.594906, 161, 0.427989, 162, 0.261882, 163, 0.096576,
	  12, 158, 0.068798, 159, 0.237358, 160, 0.405094, 161, 0.572011, 162, 0.738118, 163, 0.903425, 164, 0.932060, 165, 0.768331, 166, 0.605385, 167, 0.443211, 168, 0.281801, 169, 0.121144,
	  13, 164, 0.067940, 165, 0.231669, 166, 0.394615, 167, 0.556789, 168, 0.718199, 169, 0.878856, 170, 0.961244, 171, 0.802074, 172, 0.643654, 173, 0.485953, 174, 0.328980, 175, 0.172719, 176, 0.017178,
	  13, 170, 0.038756, 171, 0.197926, 172, 0.356346, 173, 0.514047, 174, 0.671020, 175, 0.827281, 176, 0.982822, 177, 0.862328, 178, 0.708182, 179, 0.554723, 180, 0.401954, 181, 0.249856, 182, 0.098434,
	  13, 177, 0.137672, 178, 0.291818, 179, 0.445277, 180, 0.598046, 181, 0.750144, 182, 0.901566, 183, 0.947679, 184, 0.797585, 185, 0.648143, 186, 0.499354, 187, 0.351200, 188, 0.203695, 189, 0.056817,
	  14, 183, 0.052321, 184, 0.202415, 185, 0.351857, 186, 0.500646, 187, 0.648800, 188, 0.796305, 189, 0.943183, 190, 0.910567, 191, 0.764940, 192, 0.619929, 193, 0.475530, 194, 0.331735, 195, 0.188539, 196, 0.045939,
	  14, 190, 0.089433, 191, 0.235060, 192, 0.380071, 193, 0.524470, 194, 0.668265, 195, 0.811461, 196, 0.954061, 197, 0.903933, 198, 0.762513, 199, 0.621678, 200, 0.481416, 201, 0.341724, 202, 0.202601, 203, 0.064041,
	  14, 197, 0.096067, 198, 0.237487, 199, 0.378322, 200, 0.518584, 201, 0.658276, 202, 0.797399, 203, 0.935959, 204, 0.926046, 205, 0.788596, 206, 0.651695, 207, 0.515343, 208, 0.379530, 209, 0.244258, 210, 0.109512,
	  15, 204, 0.073954, 205, 0.211404, 206, 0.348305, 207, 0.484657, 208, 0.620470, 209, 0.755742, 210, 0.890488, 211, 0.975298, 212, 0.841606, 213, 0.708430, 214, 0.575773, 215, 0.443628, 216, 0.311988, 217, 0.180856, 218, 0.050224,
	  16, 211, 0.024702, 212, 0.158394, 213, 0.291571, 214, 0.424227, 215, 0.556372, 216, 0.688012, 217, 0.819144, 218, 0.949776, 219, 0.920087, 220, 0.790443, 221, 0.661293, 222, 0.532618, 223, 0.404428, 224, 0.276718, 225, 0.149486, 226, 0.022714,
	  16, 219, 0.079913, 220, 0.209557, 221, 0.338707, 222, 0.467382, 223, 0.595572, 224, 0.723282, 225, 0.850514, 226, 0.977286, 227, 0.896416, 228, 0.770586, 229, 0.645212, 230, 0.520291, 231, 0.395830, 232, 0.271821, 233, 0.148258, 234, 0.025133,
	  16, 227, 0.103584, 228, 0.229414, 229, 0.354788, 230, 0.479709, 231, 0.604170, 232, 0.728179, 233, 0.851742, 234, 0.974867, 235, 0.902453, 236, 0.780212, 237, 0.658408, 238, 0.537035, 239, 0.416092, 240, 0.295572, 241, 0.175467, 242, 0.055793,
	  16, 235, 0.097547, 236, 0.219788, 237, 0.341592, 238, 0.462965, 239, 0.583908, 240, 0.704428, 241, 0.824533, 242, 0.944207, 243, 0.936527, 244, 0.817683, 245, 0.699239, 246, 0.581212, 247, 0.463592, 248, 0.346366, 249, 0.229548, 250, 0.113115,
	  17, 243, 0.063473, 244, 0.182317, 245, 0.300761, 246, 0.418788, 247, 0.536408, 248, 0.653634, 249, 0.770452, 250, 0.886885, 251, 0.997091, 252, 0.881453, 253, 0.766208, 254, 0.651334, 255, 0.536860, 256, 0.422758, 257, 0.309042, 258, 0.195696, 259, 0.082729,
	  18, 251, 0.002909, 252, 0.118547, 253, 0.233792, 254, 0.348666, 255, 0.463140, 256, 0.577242, 257, 0.690958, 258, 0.804304, 259, 0.917271, 260, 0.970133, 261, 0.857902, 262, 0.746041, 263, 0.634544, 264, 0.523411, 265, 0.412634, 266, 0.302213, 267, 0.192155, 268, 0.082439,
	  19, 260, 0.029867, 261, 0.142098, 262, 0.253959, 263, 0.365456, 264, 0.476589, 265, 0.587366, 266, 0.697787, 267, 0.807845, 268, 0.917561, 269, 0.973072, 270, 0.864060, 271, 0.755396, 272, 0.647067, 273, 0.539087, 274, 0.431440, 275, 0.324135, 276, 0.217163, 277, 0.110526, 278, 0.004215,
	  19, 269, 0.026928, 270, 0.135940, 271, 0.244604, 272, 0.352933, 273, 0.460913, 274, 0.568560, 275, 0.675865, 276, 0.782837, 277, 0.889474, 278, 0.995785, 279, 0.898238, 280, 0.792587, 281, 0.687256, 282, 0.582251, 283, 0.477572, 284, 0.373205, 285, 0.269157, 286, 0.165429, 287, 0.062012,
	  19, 279, 0.101762, 280, 0.207413, 281, 0.312744, 282, 0.417749, 283, 0.522428, 284, 0.626795, 285, 0.730843, 286, 0.834571, 287, 0.937988, 288, 0.958899, 289, 0.856106, 290, 0.753617, 291, 0.651433, 292, 0.549545, 293, 0.447969, 294, 0.346697, 295, 0.245715, 296, 0.145037, 297, 0.044640,
	  20, 288, 0.041101, 289, 0.143894, 290, 0.246383, 291, 0.348567, 292, 0.450455, 293, 0.552031, 294, 0.653303, 295, 0.754285, 296, 0.854963, 297, 0.955360, 298, 0.944541, 299, 0.844745, 300, 0.745238, 301, 0.646013, 302, 0.547071, 303, 0.448418, 304, 0.350046, 305, 0.251957, 306, 0.154142, 307, 0.056617,
	  21, 298, 0.055460, 299, 0.155255, 300, 0.254762, 301, 0.353987, 302, 0.452929, 303, 0.551582, 304, 0.649954, 305, 0.748043, 306, 0.845858, 307, 0.943383, 308, 0.959366, 309, 0.862390, 310, 0.765688, 311, 0.669254, 312, 0.573094, 313, 0.477201, 314, 0.381575, 315, 0.286224, 316, 0.191125, 317, 0.096294, 318, 0.001736,
	  21, 308, 0.040634, 309, 0.137610, 310, 0.234312, 311, 0.330746, 312, 0.426906, 313, 0.522799, 314, 0.618425, 315, 0.713776, 316, 0.808875, 317, 0.903706, 318, 0.998264, 319, 0.907424, 320, 0.813379, 321, 0.719586, 322, 0.626038, 323, 0.532772, 324, 0.439743, 325, 0.346967, 326, 0.254443, 327, 0.162164, 328, 0.070144,
	  21, 319, 0.092576, 320, 0.186621, 321, 0.280414, 322, 0.373962, 323, 0.467228, 324, 0.560257, 325, 0.653033, 326, 0.745557, 327, 0.837836, 328, 0.929856, 329, 0.978355, 330, 0.886826, 331, 0.795534, 332, 0.704488, 333, 0.613671, 334, 0.523114, 335, 0.432780, 336, 0.342698, 337, 0.252838, 338, 0.163216, 339, 0.073847,
	  23, 329, 0.021645, 330, 0.113174, 331, 0.204466, 332, 0.295512, 333, 0.386329, 334, 0.476886, 335, 0.567220, 336, 0.657302, 337, 0.747162, 338, 0.836784, 339, 0.926153, 340, 0.984684, 341, 0.895759, 342, 0.807072, 343, 0.718606, 344, 0.630379, 345, 0.542374, 346, 0.454584, 347, 0.367031, 348, 0.279694, 349, 0.192580, 350, 0.105688, 351, 0.019018,
	  23, 340, 0.015316, 341, 0.104241, 342, 0.192928, 343, 0.281394, 344, 0.369621, 345, 0.457626, 346, 0.545416, 347, 0.632968, 348, 0.720306, 349, 0.807420, 350, 0.894312, 351, 0.980982, 352, 0.932572, 353, 0.846332, 354, 0.760309, 355, 0.674515, 356, 0.588914, 357, 0.503551, 358, 0.418380, 359, 0.333432, 360, 0.248692, 361, 0.164160, 362, 0.079828,
	  24, 352, 0.067428, 353, 0.153667, 354, 0.239691, 355, 0.325485, 356, 0.411086, 357, 0.496449, 358, 0.581620, 359, 0.666568, 360, 0.751308, 361, 0.835840, 362, 0.920172, 363, 0.995718, 364, 0.911802, 365, 0.828101, 366, 0.744592, 367, 0.661292, 368, 0.578199, 369, 0.495307, 370, 0.412607, 371, 0.330108, 372, 0.247809, 373, 0.165711, 374, 0.083813, 375, 0.002093,
	  25, 363, 0.004282, 364, 0.088198, 365, 0.171899, 366, 0.255408, 367, 0.338708, 368, 0.421801, 369, 0.504693, 370, 0.587393, 371, 0.669892, 372, 0.752191, 373, 0.834289, 374, 0.916187, 375, 0.997907, 376, 0.920581, 377, 0.839255, 378, 0.758129, 379, 0.677196, 380, 0.596449, 381, 0.515894, 382, 0.435525, 383, 0.355342, 384, 0.275359, 385, 0.195546, 386, 0.115927, 387, 0.036493,
	  25, 376, 0.079419, 377, 0.160745, 378, 0.241871, 379, 0.322804, 380, 0.403551, 381, 0.484106, 382, 0.564475, 383, 0.644658, 384, 0.724641, 385, 0.804454, 386, 0.884073, 387, 0.963507, 388, 0.957244, 389, 0.878173, 390, 0.799295, 391, 0.720580, 392, 0.642058, 393, 0.563715, 394, 0.485541, 395, 0.407561, 396, 0.329737, 397, 0.252106, 398, 0.174652, 399, 0.097362, 400, 0.020250,
	  26, 388, 0.042756, 389, 0.121827, 390, 0.200705, 391, 0.279420, 392, 0.357942, 393, 0.436285, 394, 0.514458, 395, 0.592439, 396, 0.670263, 397, 0.747894, 398, 0.825348, 399, 0.902638, 400, 0.979750, 401, 0.943316, 402, 0.866553, 403, 0.789953, 404, 0.713531, 405, 0.637287, 406, 0.561192, 407, 0.485282, 408, 0.409543, 409, 0.333959, 410, 0.258546, 411, 0.183297, 412, 0.108211, 413, 0.033302,
	  27, 401, 0.056684, 402, 0.133447, 403, 0.210047, 404, 0.286469, 405, 0.362713, 406, 0.438808, 407, 0.514718, 408, 0.590457, 409, 0.666041, 410, 0.741454, 411, 0.816703, 412, 0.891789, 413, 0.966698, 414, 0.958543, 415, 0.883946, 416, 0.809513, 417, 0.735250, 418, 0.661143, 419, 0.587193, 420, 0.513405, 421, 0.439773, 422, 0.366297, 423, 0.292984, 424, 0.219827, 425, 0.146826, 426, 0.073981, 427, 0.001291,
	  27, 414, 0.041457, 415, 0.116054, 416, 0.190487, 417, 0.264750, 418, 0.338857, 419, 0.412807, 420, 0.486595, 421, 0.560227, 422, 0.633703, 423, 0.707016, 424, 0.780173, 425, 0.853174, 426, 0.926019, 427, 0.998709, 428, 0.928743, 429, 0.856366, 430, 0.784130, 431, 0.712049, 432, 0.640117, 433, 0.568341, 434, 0.496713, 435, 0.425241, 436, 0.353910, 437, 0.282727, 438, 0.211700, 439, 0.140800, 440, 0.070062,
	  28, 428, 0.071257, 429, 0.143634, 430, 0.215870, 431, 0.287951, 432, 0.359883, 433, 0.431659, 434, 0.503287, 435, 0.574759, 436, 0.646090, 437, 0.717273, 438, 0.788300, 439, 0.859200, 440, 0.929938, 441, 0.999473, 442, 0.929025, 443, 0.858717, 444, 0.788550, 445, 0.718532, 446, 0.648663, 447, 0.578926, 448, 0.509338, 449, 0.439884, 450, 0.370578, 451, 0.301406, 452, 0.232382, 453, 0.163485, 454, 0.094728, 455, 0.026120,
	  30, 441, 0.000527, 442, 0.070975, 443, 0.141283, 444, 0.211450, 445, 0.281468, 446, 0.351338, 447, 0.421074, 448, 0.490662, 449, 0.560116, 450, 0.629422, 451, 0.698594, 452, 0.767618, 453, 0.836515, 454, 0.905272, 455, 0.973880, 456, 0.957645, 457, 0.889296, 458, 0.821096, 459, 0.753029, 460, 0.685089, 461, 0.617289, 462, 0.549616, 463, 0.482091, 464, 0.414692, 465, 0.347420, 466, 0.280288, 467, 0.213282, 468, 0.146403, 469, 0.079665, 470, 0.013052,
	  30, 456, 0.042355, 457, 0.110704, 458, 0.178904, 459, 0.246971, 460, 0.314911, 461, 0.382711, 462, 0.450384, 463, 0.517909, 464, 0.585308, 465, 0.652580, 466, 0.719712, 467, 0.786718, 468, 0.853597, 469, 0.920335, 470, 0.986948, 471, 0.946567, 472, 0.880200, 473, 0.813981, 474, 0.747882, 475, 0.681908, 476, 0.616060, 477, 0.550347, 478, 0.484751, 479, 0.419290, 480, 0.353947, 481, 0.288723, 482, 0.223632, 483, 0.158653, 484, 0.093814, 485, 0.029095
	};

	float32_t sum = 0;
	int num_elements = 0;
	int bin_counter = 0;
	for(int outer = 0; outer < listsize; ){
		sum = 0;
		num_elements = 2 * list[outer];

		for(int inner = 1; inner < num_elements; inner = inner + 2){
			sum += magnitude[(int)list[outer + inner]] * list[outer + inner + 1];
		}

		log_mel_spectrogram[bin_counter] = log(sum);
		outer += 1 + num_elements;
		bin_counter++;

	}

}


